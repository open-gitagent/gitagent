{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://gitagent.dev/schemas/hook-io.schema.json",
  "title": "gitagent Hook I/O Protocol",
  "description": "Schema for the JSON stdin/stdout protocol used by hook scripts",
  "$defs": {
    "hook_input": {
      "type": "object",
      "required": ["event", "timestamp", "data", "session"],
      "description": "JSON object passed to hook scripts via stdin",
      "properties": {
        "event": {
          "type": "string",
          "enum": [
            "on_session_start",
            "on_session_end",
            "pre_tool_use",
            "post_tool_use",
            "on_error",
            "pre_response",
            "post_response"
          ],
          "description": "Lifecycle event that triggered this hook"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of the event"
        },
        "data": {
          "type": "object",
          "description": "Event-specific payload",
          "properties": {
            "tool_name": {
              "type": "string",
              "description": "Tool being invoked (pre_tool_use, post_tool_use)"
            },
            "arguments": {
              "type": "object",
              "description": "Tool arguments (pre_tool_use)"
            },
            "result": {
              "description": "Tool result (post_tool_use)"
            },
            "response": {
              "type": "string",
              "description": "Agent response text (pre_response, post_response)"
            },
            "error": {
              "type": "object",
              "properties": {
                "message": { "type": "string" },
                "code": { "type": "string" },
                "stack": { "type": "string" }
              },
              "description": "Error details (on_error)"
            }
          }
        },
        "session": {
          "type": "object",
          "required": ["id", "agent"],
          "properties": {
            "id": {
              "type": "string",
              "description": "Session identifier"
            },
            "agent": {
              "type": "string",
              "description": "Agent name"
            },
            "model_version": {
              "type": "string",
              "description": "Model being used"
            },
            "turn": {
              "type": "integer",
              "description": "Current conversation turn number"
            }
          }
        }
      },
      "additionalProperties": false
    },
    "hook_output": {
      "type": "object",
      "required": ["action"],
      "description": "JSON object returned by hook scripts via stdout",
      "properties": {
        "action": {
          "type": "string",
          "enum": ["allow", "block", "modify"],
          "description": "'allow': proceed as normal. 'block': prevent the action. 'modify': proceed with modifications."
        },
        "modifications": {
          "description": "Modified data when action is 'modify'. Structure matches the input data field.",
          "oneOf": [
            { "type": "object" },
            { "type": "null" }
          ]
        },
        "reason": {
          "type": "string",
          "description": "Human-readable reason for block/modify actions"
        },
        "audit": {
          "type": "object",
          "description": "Audit metadata to attach to the event log",
          "properties": {
            "logged": {
              "type": "boolean",
              "description": "Whether this event was written to the audit log"
            },
            "log_id": {
              "type": "string",
              "description": "Identifier of the audit log entry"
            },
            "timestamp": {
              "type": "string",
              "format": "date-time"
            },
            "escalated": {
              "type": "boolean",
              "description": "Whether this event was escalated to a supervisor"
            },
            "finalized": {
              "type": "boolean",
              "description": "Whether the audit log was sealed"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  }
}
